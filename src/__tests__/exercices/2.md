# Utilisation de react-testing-library

On va recrÃ©er nos tests qu'on a fait avant en utilisant la library `react-testing-library`.

Cette librairie va gÃ©rer tout ce qui touche aux render et Ã  la rÃ©cupÃ©ration des Ã©lÃ©ments.

RÃ©cupÃ©rer des Ã©lÃ©ments avec div.querySelector est une mauvaise pratique car on ne sait pas si l'Ã©lÃ©ment est vraiment visible, ou s'il a les bons attributs.

On va prÃ©fÃ©rer rÃ©cupÃ©rer les Ã©lÃ©ments en fonction de leur texte et de leur rÃ´le, pour ne
pas dÃ©pendre de l'implÃ©mentation dans le DOM.

Mais on va faire ceci **Ã©tape par Ã©tape**.

## Partie 1

Cette fois on va crÃ©er un mega test qui test le bouton `plus` et le bouton `minus`.

Ce qui va changÃ© c'est que tu vas utiliser la fonction `render` qui va te retourner `container`, elle correspond Ã  la div qui contient ton composant.

```js
import { render } from 'react-testing-library';

const { container } = render(<Counter />);
```

- [ğŸ“– `render`](https://testing-library.com/docs/react-testing-library/api#render)
- [ğŸ“– `react-testing-library`](https://testing-library.com/docs/react-testing-library/intro)

On va utiliser les fonctions utilitaires de `react-testing-library` pour rÃ©cupÃ©rer nos Ã©lÃ©ments.

Afin de rÃ©cupÃ©rer les boutons on va pouvoir utiliser `screen.getByRole('button', { name: '+' })`.

Et pour rÃ©cupÃ©rer l'Ã©lÃ©ment span de text, on va pouvoir utiliser `screen.getByText('0')`.

- [ğŸ“– `getByRole`](https://testing-library.com/docs/queries/byrole)
- [ğŸ“– `getByText`](https://testing-library.com/docs/queries/bytext)

Tu peux aussi utiliser [screen.debug()](https://testing-library.com/docs/react-testing-library/api#debug) afin
d'afficher ce qui se passe dans le dom !

Tu remarqueras qu'on a aussi accÃ¨s Ã  de nouvelles assertions offertes par la librairie [`@testing-library/jest-dom`](`@testing-library/jest-dom/matchers`) !

- [`expect(element).toBeInTheDocument()`](https://github.com/testing-library/jest-dom#tobeinthedocument)
- [`expect(element).toHaveTextContent()`](https://github.com/testing-library/jest-dom#tohavetextcontent)
- [toutes les autres](https://github.com/testing-library/jest-dom#custom-matchers)

## Partie 2

On est toujours entrain de faire les `click` Ã  la main, mais `react-testing-library` propose
une librairie gÃ©nial pour gÃ©rer Ã§a pour nous : `user-event`.

On va pouvoir remplacer notre `plusButton.click()` ainsi que notre `wait(1)` par
`user.click(plusButton)`.

Cette librairie va faire comme si c'Ã©tait un vrai utilisateur qui cliquant sur notre bouton.

Je te laisse suivre [ğŸ“– la documentation](https://testing-library.com/docs/user-event/intro/#writing-tests-with-userevent)
pour correctement implÃ©menter `user-event`.

(tu remarqueras la parties `setup`)

## Partie 3

Ã§a risque de pas Ãªtre super de devoir, Ã  chaque fois, instanciÃ© notre `userEvent.setup()`.

Pour rÃ©soudre ce problÃ¨me il nous propose de crÃ©er une fonction `setup` qui va render en plus
de setup `userEvent`.

```js
// setup function
function setup(jsx) {
  return {
    user: userEvent.setup(),
    ...render(jsx),
  };
}
```

[ğŸ“– la documentation](https://testing-library.com/docs/user-event/intro/#writing-tests-with-userevent)

Ajoute cette fonction et refactor le code !

## Partie 4 - Bonus pas corrigÃ©

Tu peux ajouter les deux autres tests fait dans l'exercice 1 utilisant `react-testing-library`.

- Test de l'event onChange
- Test de la defaultValue

Pas de correction vidÃ©o pour cette partie, c'est juste pour t'entraÃ®ner.
